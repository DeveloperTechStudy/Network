# 7주차_chap07

p382 ~ 

# 네트워크 심화

## 07-1 안정성을 위한 기술

### 가용성

- 안정성: 특정 기능을 언제든 균일한 성능으로 수행할 수 있는 특성
    - 안정적인 웹 서버 - 언제든지 응답 메시지를 제공할 수 있는 서버

**가용성**

- 안정성의 정도를 나타내는 것
- 컴퓨터 시스템이 특정 기능을 **실제로 수행할 수 있는 시간**의 비율.
- 가용성이 높으면(**HA**, high availability), 전체 사용 시간 중에서 대부분을 사용 가능하다는 의미
- 전체 사용 시간 중 정상적인 사용 시간(업타임)
    
    $가용성 = \frac{업타임}{업타임+타운타임}$
    
- **결함 감내** (fault tolerance): 다운타임을 줄이기 위해서는 문제가 발생하더라도 계속 기능할 수 있도록 설계해야 함

### 이중화

- 무언가를 이중으로 두어 예비(백업)을 마련하는 기술
- 결함을 감내하여 가용성을 높이기 위한 기본적이고 대표적인 방법
- 이중화 대상 : 서버 컴퓨터, 네트워크 인터페이스(NIC), 스위치와 같은 물리적 장비/ DB, 웹 서버 프로그램 등 → 단일 장애점임
- 단일 장애점(SPoF: Single Point Of Failure) : 문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상
    - ex) SPOF인 라우터가 고장나면 서버로부터 제공받는 서비스 전체가 동작하지 않음
    - 최대한 없어야 함
    - 즉 SPOF를 이중화하는 것이 좋음
- 이중화 구성
    - 액티브는 가동 상태, 스탠바이는 액티브의 백업으로서 대기하는 상태
    1. 액티브/스탠바이 (active-standby) : 한 시스템은 가동하고, 다른 시스템은 백업 용도로 대기 상태로 둔다. 두 장비가 동시에 가동되는 것이 아니라 성능상 변화는 크지 않다.
    2. 액티브/액티브 (active-active) : 두 시스템 모두를 가동 상태로 둔다. 문제가 생기면 순간적으로 다른 시스템에 부하가 급증할 수 있다.

![image.png](image.png)

- 다중화 : 확장된 이중화 기술로, 무언가를 여러 개 두는 기술
- 티밍(teaming)과 본딩(bonding) : 여러 개의 네트워크 인터페이스(NIC)를 이중화/다중화하여 더 뛰어나고 안정적인 하나의 인터페이스처럼 보이게 하는 기술

### 로드밸런싱

**트래픽(traffic)**

- 주어진 시점에서 네트워크를 경유한 데이터의 양.
- 일반적으로 노드에서 측정하므로, 주어진 시점에서 특정 노드를 경유한 패킷의 양으로 볼 수 있다.
- 과도한 트래픽은 서버 가용성을 떨어트림. 이는 다중화로도 해결 X

**로드 밸런싱**

- 트래픽의 고른 분배를 위해 사용되는 기술
- 로드 밸런서에 의해 수행됨
- 이중화(다중화)된 서버와 클라이언트 사이에 위치

![image.png](image%201.png)

- 로드 밸런싱 알고리즘 : 라운드 로빈 알고리즘, 최소 연결 알고리즘, 가중치 라운드 로빈 알고리즘, 가중치 최소 연결 알고리즘
    - 혹은 해시(hash)자료 구조 이용, 응답 시간이 가장 짧은 서버 선택 등

![image.png](image%202.png)

- 헬스 체크(health check) : 다중화된 서버 환경에서 서버들의 건강 상태를 주기적으로 모니터링하고 검사하는 것. 로드 밸런서에 의해 이루어짐. HTTP, ICMP 등 다양한 프로토콜을 활용함
- 하트 비트(heart beat) : 서버끼리 주기적으로 주고받는 메시지. 신호가 끊기면 문제 발생을 감지한다.

### 포워드 프록시와 리버스 프록시

- 오리진 서버(origin server) : 자원을 생성하고 클라이언트에게 권한 있는 응답을 보낼 수 있는 HTTP 서버. 클라이언트와 오리진 서버 사이에는 많은 중간 서버가 있을 수 있다.
- HTTP 중간 서버의 유형
    1. 프록시(proxy): 포워드 프록시. **클라이언트가 선택한** 메시지 전달 대리자. 캐시 저장, 클라이언트 암호화 및 접근 제한 등의 기능 제공
    2. 게이트웨이(gateway) : 리버스 프록시. 아웃바운드 연결에 대해 **오리진 서버 역할**을 하지만, 수신된 요청을 변환하여 인바운드 서버(들)로 전달하는 중재자 역할

![image.png](image%203.png)

* 다중화된 오리진 서버들의 네트워크 : 오리진 서버들이 사는 대저택
프록시 : 클라이언트를 대신해 대저택에 심부름가는 심부름꾼
게이트웨이: 대저택을 지키는 경비

## 07-2 안정성을 위한 기술

### 암호화와 인증서

- 암호화 (encryption) : 원문 데이터를 알아볼 수 없는 형태로 변경하는 것
- 복호화 (decryption) : 암호화된 데이터를 원문 데이터로 되돌리는 과정

**대칭 키 암호화 방식과 공개 키 암호화 방식**

키 + 원문 데이터 —수학적 연산 과정(암호화 알고리즘)—> 암호문

1. 대칭 키 암호화
    - 암호화 키 = 복호화 키
    - 장점: 적은 부하로 빠른 암호화/복호화 수
    - 단점: 상대방에게 안전하게 키를 전달하기 어렵다. 유출 위험 크다.
       → 안전하게 전달하는 방식이 있다면, 그 방식 자체로만 메시지 주고받으면 됨
2. 공개 키 암호화 (비대칭 키 암호화)
    - 암호화 키 ≠ 복호화 키
    - 한 쌍의 키 - 공개 키, 개인 키
    - 장점: 공개 키 만으로 개인 키를 유추할 수 없어서(반대도 성립) 키를 안전하게 공유할 수 있다.
    - 단점: 암호화/복호화에 상대적으로 시간과 부하가 많이 든다.

![image.png](image%204.png)

1. 대칭 키 암호화 + 공개 키 암호화
    - 공개 키로 대칭 키를 암호화하여 상대에게 전달 
    → 개인 키로 암호화된 대칭 키를 복호화
    - 이 때 사용되는 대칭 키를 **세션 키** 라고 부름.

**인증서와 디지털 서명**

- 인증서 (**공개 키 인증서**)

![image.png](image%205.png)

- 웹 서버로부터 받은 공개 키가 신뢰할 만한가? → 웹서버는 공개 키와 생성자, 유효 기간 등을 포함한 인증서를 함께 전송
- 인증서는 인증 기관 (CA: Certification Authority)에서 발급. ex. IdenTrust, DigiCert, 등
- CA가 발급한 인증서에는 **서명 값**이 있다.
    1. 인증서 내용에 대한 해시 값(지문, fingerprint)을
    2. CA의 **개인 키**로 암호화하는 방식으로 서명 값 만든다. 
- **디지털 서명** (digital signature) - 개인 키로 암호화된 메시지를 공개 키로 복호화함으로써 신원을 증명하는 절차
    1. 서명 값과 인증서 분리 - CA의 공개 키로 복호화
    2. 인증서 데이터에 대한 해시 값을 직접 구한 뒤
    3. 이를 1번에서 복호화한 값과 비교한다.
    4. 일치하면 (CA의 공개 키로 복호화가 가능하다는 뜻) 보장된 인증서임!

### HTTPS: SSL과 TLS

- SSL (Secure Sockets Layer) : 인증과 암호화를 수행하는 프로토콜
- TLS (Transport Layer Security) : SSL을 계승한 프로토콜

**HTTPS (HTTP over TLS)**

- SSL/TLS를 사용하는 대표적인 프로토콜
- HTTP 메세지의 안전한 송수신을 위해 개발됨

**HTTPS의 동작**

1. TCP 쓰리 웨이 핸드셰이크
    - TCP 연결 수립을 위해 두 호스트가 각각 SYN, SYN+ACK, ACK 플래그가 설정된 TCP 세그먼트를 주고받는 것
2. TLS 핸드셰이크
    - 암호화 통신을 위한 키 교환
        1. 클라이언트가 암호화된 통신을 위해 맞춰 봐야 할 정보를 제시하는 메시지 전송. 
            
            *** 암호 스위트** : 사용 가능한 암호화 방식과 해시 함수를 담은 정보
            
        2. 서버는 제시된 정보들을 선택하는 메시지를 응답으로 보냄. 
        3. 두 메시지를 주고 받으며 암호화된 통신을 위해 사전 협의해야 할 정보들 결정됨
        4. 이 정보들을 토대로 서버와 클라이언트는 암호화에 사용할 키를 만들어 냄
    - 인증서 송수신과 검증
        1. 서버는 인증서와 검증을 위한 디지털 서명 메시지를 전송
        2. 클라이언트는 이 메시지를 토대로 서버의 공개 키 검증
        3. 서버와 클라이언트는 핸드셰이크의 마지막을 의미하는 Finished 메시지 주고받음. 이 때, 암호화된 메시지(Application Data)를 함께 전송할 수 있음.
3. 암호화된 메시지 송수신

## 07-3 무선 네트워크

### 전파와 주파수

- 전차(radio wave): 무선 네트워크의 연결 매체. 약 3kHz부터 3THz 사이의 진동수를 갖는 전자기파
- 수많은 무선 통신 기기가 전파를 이용하여 통신하여, 지금 이 순간에도 우리 주변 공간에 흐르고 있음.
- 자연적으로도 발생함. 번개, 태양의 활동으로 인해 우연히 할당된 주파수 대역과 겹치면 잡음 발생.
- 통신에 사용되는 전파에는 용도에 따라 나눈 ‘주파수 대역’이 미리 정해져 음. (ex. 방송용, 위성 통신용, 항공/해양 통신을 위한 주파수 등)

### 와이파이와 802.11

- 오늘날의 LAN 환경에서 표준화 된 무선 통신 규격은 IEEE 802.11
- IEEE 802.11 표준은 대부분 2.4GHa, 5GHz 대역을 사용한다.
- IEEE 802.3 버전에 따라 지원되는 네트워크 장비의 종류와 속도가 달라질 수 있는 것처럼, 
IEEE 802.11 버전에 따라 사용되는 주파수뿐만 아니라 전송 속도, 대역폭, 전송 가능한 거리 등 많은 것이 달라진다.

와이파이

- IEEE 802.11  표준을 따르는 무선 LAN 기술.
- 세대 별로 다른 IEEE 802.11 표준 규격을 준수 → 일종의 인증 마크 역할
- 특정 제품에 특정 와이파이 인증 마크가 붙으면 어떤 규격을 지켰는지, 다른 제품과의 호환성은 어떤지 알 수 있음.

### 2.4GHz 와이파이 VS 5GHz 와이파이

- 5GHz 와이파이는 비교적 송수신 속도가 빠르지만, 장애물의 영향을 크게 받는다.
2.4GHz 와이파이는 비교적 느리지만, 장애물의 영향이 덜하다.
- 주파수의 회절성 때문.

**채널**

- 2.4GHz, 5GHz 주파수 대역은 **채널**이라고 불리는 하위 주파수 대역으로 또 한 번 세분화되고, 해당 채널 대역에서 통신이 이뤄진다.
- 각 채널에는 번호가 할당되어 있음
- 동일한 대역의 네트워크를 이용할지라도 세부적인 주하수는 채널에 따라 달라진다.
- 일반적으로 자동 설정이지만, 수동으로 설정할 수도 있음. → 같은 공간에서 같은 대역의 서로 다른 네트워크를 이용할 때는 중첩(간섭)되지 않는 채널을 이용하는 것이 좋다.

![2.4GHz, 5GHz 대역의 일부 채널들을 표현한 그림](image%206.png)

2.4GHz, 5GHz 대역의 일부 채널들을 표현한 그림

### AP와 서비스 셋

- **AP** (Access Pointer) : 무선 엑세스 포인트.
- 무선 통신 기기들을 연결하여 무선 네트워크를 구성하는 장치. 네트워크를 생성하기 위해서 필요. (ex. 가정의 무선 공유기가 AP 역할 수행함)
- 유선 연결 매체를 연결할 수 있는 지점이 함께 제공되어 유선 - 무선 네트워크 연결을 담당하는 역할도 수행함
- **인프라스트럭쳐 모드** (infrastructure mode) : AP를 경유하여 통신이 이뤄지는 무선 네트워크 통신 방식. 오늘날 많은 LAN이 AP가 중개하는 인프라스트럭쳐 모드로 동작한다.
    - 애드 혹 모드 (Ad Hoc Mode) : AP의 간섭 없이 호스트 간에 일대일로 통신하는 무선 통신 모드
- **서비스 셋** (Service Set) : 무선 네트워크를 이루는 AP와 여러 장치들의 집합
    - 같은 서비스 셋에 속한 장치들은 같은 무선 네트워크에 속한다.
- **서비스 셋 식별자** (SSID): 무선 네트워크를 구분짓는 수단이자 무선 네트워크를 지칭하는 고유한 이름. 서비스 셋을 식별하기 위해 사용된다.
    - ex. 와이파이의 이름 - 무선 네트워크에 접속하기 위해 이름을 확인한다.
    - BSS(Basic Service Set): 하나의 AP로 구성된 LAN - 기본적인 서비스 셋(무선 LAN) 표현 기준
    - ESS(Extended Service Set): 여러 AP로 구성된 LAN
- **비컨 프레임** (beacon frame): AP가 불특정 다수 모두에게 자신을 알리기 위해 주기적으로 전송하는 브로드캐스트 메시지
- 비컨 프레임 안에는 SSID와 AP의 MAC 주소 등이 포함되어 있다.
    - 장치에 와이파이 연결할 때, 연결 가능한 와이파이 목록이 뜨는 이유도 AP의 비컨 프레임을 받았기 때문￼